# 2024.11.23 DIL

p445 ~ 468p

# 메모리 탭

- 메모리 누수, 속도 저하, 웹페이지 프리징 현상을 확인할 수 있다.
  1. 힙 스냅샷
  - 현재 메모리 상황을 사진 찍듯이 촬영할 수 있다.
  2. 타임라인의 할당 계측
  - 시간의 흐름에 따라 메모리의 변화를 살펴볼 수 있다.
  - 로딩이 되는 과정의 메모리 변화, 페이지에서 어떠한 상호작용을 했을 때 메모리의 변화 과정을 알고 싶을 때 사용
  3. 할당 샘플링
  - 메모리 공간을 차지하고 있는 자바스크립트 함수를 볼 수 있다.

### 자바스크립트 인스턴스 VM 선택

- VM 환경을 선택할 수 있다.
- 환경별 힙 크기를 볼 수 있는데, 실제 해당 페이지가 자바스크립트 힙을 얼마나 점유하고 있는지 나타낸다.
- 이 크기만큼 사용자의 브라우저에 부담을 주기 때문에 불필요하게 크기가 늘어나지 않는지 눈여겨볼 필요가 있다.

### 힙 스냅샷

- take snapshot을 통해 스냅샷을 찍어 확인한다.
- 스냅샷을 비교할 2가지의 스냅샷을 찍고, 모든객체 -> 스냅샷 1에서 스냅샷 2 사이에 할당된 객체 클릭 -> 얕은 크기 항목을 기준으로 내림차순
- 스냅샷을 활용할 때는 의심이 되는 지점을 먼저 추측해서 스냅샷을 찍고 -> 특정 동작 이후 스냅샷을 찍어 2개를 비교해보자.
- 정보가 많이 담겨있어 개발자가 원하는 메모리 누수 정보를 찾기는 쉽지 않다 -> 예측을 하고, 2개를 비교하는 방법이 좋다.
- 원인을 정확하게 파악하려면 변수와 함수에 적절한 이름을 주어 수많은 메모리 내용 사이에서 눈에 띄게 하는 것이 큰 도움이 된다.

### 타임라인 할당 계측

- 시간의 흐름에 따라 메모리 변화를 확인할 수 있는 기능
- 시간의 흐름에 따라 메모리의 변화를 모두 기록하기 때문에 상대적으로 많은 부담이 발생한다.
- 특정 기간을 좁혀서 확인해 볼 수 있다.
- 시간의 흐름에 따른 메모리 변화를 비롯해 메모리 변화를 일으킨 변수가 무엇인지, 해당 변수가 어느 정도 크기를 차지하고 있는지 확인할 수 있다.

### 할당 샘플링

- 자바스크립트 실행 스택별로 분석할 수 있고, 이 분석을 함수 단위로 한다는 차이점 존재.
- 타임라인 할당 계측과 유사하지만 프로파일링할 때 브라우저에 주는 부담을 최소화할 수 있어 장시간 디버깅할ㄷ 때 유리하다.

---

# NextJs 환경 디버깅하기

### NextJs 프로젝트를 디버그 모드로 실행하기

- 아래의 명령어? 로 시작한다.
- "dev" : NODE_OPTIONS='--inspect' next dev
- 크롬 브라우저에서 chrome://inspect로 이동
- Open dedicated DevTools for Node 클릭

### NExtJs 서버에 트래픽 유입시키기

- 오픈소스 도구인 ab를 사용하여 트래픽을 유입시키자!
  - 터미널에서 명령어 입력 `ab -k -c 50 -n 10000 "http://127.0.0.1:3000/"`
    - http://127.0.0.1:3000/ 을 향해 한 번에 50개의 요청을 총 10,000회 시도
  - ab를 활용하면 요청 뿐 아니라 응답받는 데 걸린 시간, 바이트 크기 등 다양한 정보를 확인할 수 있다.

### NextJs의 메모리 누수 지점 확인하기

- 메모리탭에서 확인해본다.
