# 2024.12.26 DIL

p874 ~

# 웹사이트 보안을 위한 리액트와 웹페이지 보안 이슈

- 웹사이트의 성능만큼 중요한 것은 보안이다.
- 프론트엔드에서 해야 할 일이 많아짐 -> 코드의 규모가 증가 -> 보안 취약점에 노출될 확률도 증가

## 리액트에서 발생하는 크로스 사이트 스크립팅(XSS)

- 크로스 사이트 스크립팅이란 웹 어플리케이션에서 가장 많이 보이는 취약점 중 하나로, 웹사이트 개발자가 아닌 제3가작 웹사이트에 악성 스크립트를 삽입해 실행할 수 있는 취약점을 의미한다.
- 이 취약점은 일반적으로 게시판과 같이 사용자가 입력을 할 수 있고, 이 입력을 다른 사용자에게 보여줄 수 있는 경우에 발생한다.
- 아래의 위험성이 있다.

  1. 쿠키를 획득해 사용자의 로그인 세션을 탈취
  2. 사용자의 데이터를 변경

- 리액트에서 XSS 이슈는 어떻게 발생할 수 있을까?

### dangerouslySetInnerHTMLprop

- 특정 브라우저 DOM의 innerHTML을 특정한 내용으로 교체할 수 있는 방법이다.
- 일반적으로 게시판과 같이 사용자나 관리자가 입력한 내용을 브라우저에 표시하는 용도로 사용
- \_\_html을 키를 가지고 이쓴ㄴ 개체만 인수로 받을 수 있으며, 인수를 넘겨받은 문자열을 DOM에 그대로 표시하는 역할을 한다.
- 위험성 : 인수로 받는 문자열에 제한이 없다. -> 넘겨주는 문자열 값은 한 번 더 검증이 필요함

### useRef를 활용한 직접 삽입

- useRef를 활용하면 직접 DOM에 접근할 수 있으므로, dangerouslySetInnerHTMLprop와 비슷한 방식으로 innerHTML에 보안 취약점이 있는 스크립트를 삽입하면 동일한 문제가 발생
- 아래의 여러가지 방식의 XSS가 있지만 공통적인 문제는 웹사이트 개발자가 만들지 않은 코드를 삽입하는 것에 있다.
  1. <script> 삽입
  2. svg/onload 사용
  3. <a> 태그에 잘못된 href 삽입
  4. onclick, onload 등 이벤트 활용

### 리액트에서 XSS 문제를 피하는 방법

- 가장 확실한 방법은 제3자가 삽입할 수 있는 HTML을 안전한 HTML 코드로 한 번 치환하는 것
- 이 과정을 새니타이즈(sanitize) 또는 이스케이프(escape)라고 한다. -> 직접 구현할 수 있지만 가장 확실한 방법은 npm 라이브러리 사용하는 것

  1. DOMpurity
  2. sanitize-html
  3. js-xss

- sanitize-html은 허용할 태그와 목록을 일일히 나열하는 이른바 허용 목록 방식을 채택하기 때문에 사용하기가 매우 귀찮게 느껴질 수 있다.
- 그러나 이 방식이 훨씬 안전하다.
- 또 한가지 중요한 것은 단순히 보여줄 때뿐만 아니라 사용자가 컨텐츠를 저장할때도 한번 이스케이프 과정을 거치는 것이 더 효율적이고 안전하다.
- 이런 치환 과정은 되도록 서버에서 수행하는 것이 좋다. -> 일반적인 사용자라면 문제가 되지 않지만 POST 요청을 스크립트나 curl 등으로 직접 요청할 경우 스크립트에서 실행하는 이스케이프 과정을 생략하고 바로 저장될 가능성이 있다.
- 따라서 서버는 `클라이언트 사용자가 입력한 데이터는 일단 의심한다`라는 자세로 클라이언트의 POST 요청에 있는 HTML을 이스케이프 하는 것이 제일 안전하다.
- 마지막으로 단순히 게시판과 같은 예시가 없어도 충분히 XSS 문제는 발생할 수 있다.
- 개발자는 자신이 작성한 코드가 아닌 query, GET 파라미터, 서버에 저장된 사용자가 입력한 데이터 등 외부에 존재하는 모든 코드를 위험한 코드로 간주하고 적절하게 처리하는게 좋다.
