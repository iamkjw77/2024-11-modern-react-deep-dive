## 7.5 메모리 탭

현재 웹페이지가 차지하고 있는 메모리 관련 정보를 확인할 수 있다.  
애플리케이션에서 발생하는 메모리 누수, 속도 저하, 혹은 웹페이지 프리징 현상을 확인할 수 있는 유용한 도구다.

#### 프로파일링 유형

- 힙 스냅샷 : 현재 메모리 상황이 아닌 시간의 흐름에 따라 메모리의 변화를 살펴볼 수 있다.
- 타임라인의 할당 계측 : 시간의 흐름에 따라 메모리의 변화를 볼 수 있다.
- 할당 샘플링 : 메모리 공간을 차지하고 있는 자바스크립트 함수를 볼 수 있다.

### 7.5.1 자바스크립트 인스턴스 VM 선택

- 디버깅을 하고싶은 자바스크립트 VM 환경을 선택한다.
- 환경별 힙 크기를 볼 수 있는데, 실제 해당 페이지가 자바스크립트 힙을 얼마나 점유하고 있는지 나타낸다.
- 이 크기는 자바스크립트 실행에 따라 실시간으로 바뀐다. 사용자의 브라우저에 부담을 주기 때문에 불필요하게 크기가 늘어나지 않는지 눈여겨볼 필요가 있다

### 7.5.2 힙 스냅샷

- 현재 페이지의 메모리 상태를 확인해 볼 수 있는 메모리 프로파일 도구다.
- 마치 사진으로 촬영하듯이 스냅샷을 찍어 메모리 현황을 보여준다.
- 스냅샷을 비교하면 어떤 변수가 메모리 사용량 차이를 발생했다는 것을 명확히 확인할 수 있다.

### 7.5.3 타임라인 할당 계측

- 시간의 흐름에 따라 메모리 변화를 확인할 수 있는 기능이다
- 메모리 변화를 일으킨 변수가 무엇인지, 그리고 해당 변수가 어느 정도 크기를 차지하고 있는 등을 확인할 수 있다.

### 할당 샘플링

- 시간의 흐름에 따라 발생하는 메모리 점유를 확인할 수 있다
- 할당 계측과 비슷하지만 자바스크립트 실행 스택별로 분석할 수 있고, 이 분석을 함수 단위로 한다는 차이점이 있다.
- 오랜기간 메모리 누수가 의심되어 프로파일링을 장기간 수행해야 하는 경우에는 할당 샘플링을 활용하는 것이 좋다

## 7.6 Next.js 환경 디버깅하기

서버 사이드 렌더링 환경에서 메모리 누수가 발생한다면 서버 자체에 부담이 발생할 것이고, 서버의 부담은 곧 모든 사용자가 서비스를 사용할 수 없는 심각한 상황을 초래하게 될 것이다.

### 7.6.1 Next.js 프로젝트를 디버그 모드로 실행하기

- 가장 먼저 할 일은 Next.js 프로젝트를 디버그 모드로 실행해야 한다.

```
"dev": NODE_OPTIONS='--inspect' next dev
```

- 위 인수와 함께 실행하면 디버거가 활성화되면서 디버그 모드가 켜진 것을 확인할 수 있다.
- 웹브라우저에서 "Open dedicated DevTools for Node"를 클릭하면 다음과 같이 새로운 창에서 개발자 도구가 나타는 것을 확인할 수 있다.

### 7.6.2 Next.js 서버에 트래픽 유입시키기

- 서버 사이드 렌더링은 사용자가 유입되면서 메모리 누수가 발생하는 경우가 많다. 따라서 버서에 직접 트래픽을 발생시켜서 확인하는 편이 제일 확실하다
- 오픈소스 ab를 사용하면 서버로 트래픽이 몰리는 상황을 시뮬레이션할 수 있다
- ab는 아파치 재단에서 제공하는 웹서버 성능 검사 도구로, HTTP 서버의 성능을 벤치마킹할 수 있는 도구다.

```
ab -k -c 50 -n 10000 "http://127.0.0.1:3000/"
```

- 위 명령어는 http://127.0.0.1:3000/을 향해 한 번에 50개의 요청을 총 10,000회 시도한다.
- 단순히 요청을 수행하는 것뿐만 아니라 요청으로부터 응답받는 데 걸린 시간, 바이트 크기 등 다양한 정보를 확인할 수 있다.

### 7.6.3 Next.js의 메모리 누수 지점 확인하기

- 생략
